# browser_agent

[English version is available here](README.md)  
Приложение для автоматизации браузера с использованием ИИ-агента.  
[Установка](#установка)  
[Запуск](#запуск)  
[Документация](#документация)  
[Информация](#информация)

## Установка
После клонирования репозитория, необходимо:  
1. Убедиться, что установлен Python версии не выше 3.12:
```bash
python --version
>> Python 3.11.4
```
2. Перейти в src:
```bash
cd src
ls
>> ai environment ui main.py requirements.txt
```
3. Создать и активировать venv (один из вариантов):
```bash
python -m venv venv
./venv/Scripts/activate
```
4. Установить все зависимости:
```bash
pip install -r requirements.txt
```

## Запуск
Для запуска приложения достаточно:
1. Активировать venv в src (если еще не активирован):
```bash
./venv/Scripts/activate
```
2. Запустить приложение из src:
```bash
python main.py
```

## Документация
1. Приложение имеет три основных поля: верхнее - поле вывода информации от агента, среднее - поле для ввода API-ключа, нижнее - поле для запроса.  
2. Приложение имеет 4 кнопки: желтая - кнопка проверки API-ключа, зеленая - кнопка отправки запроса, синяя - кнопка сохранения JSON-отчета, красная - кнопка очистки поля вывода.   
3. ИИ-агент работает на модели glm-4.6v-flash от [Zhipu AI](https://z.ai/subscribe), поэтому для работы с агентом необходимо получить API-ключ на официальном сайте. После получения необходимо поместить ключ в среднее поля приложения.  
4. Для проверки API-ключа можно нажать на желтую кнопку справа от среднего поля: в случае успеха желтая кнопка станет зеленой, а API-ключ будет запомнен в системе для будущего использования.  
5. Если не проверить API-ключ самостоятельно, он будет автоматически проверен при отправке запроса.  
6. Отправка запроса осуществяется при помощи нажатия на зеленую кнопку.  
7. Во время работы приложения, агент периодически будет отправлять различные сообщения в верхнее поле. Нажатие на красную кнопку полностью очистит это поле.
8. Нажатие на синюю кнопку сохранит текущую сессию в виде JSON-отчета. Сессия может выглядеть следующим образом:
```json
{
	"prompts": [
		[
			["role": "user", "content": "[prompt...]"]
			["role": "assistant", "content": "[result...]"]
			...
		]
		[
			["role": "user", "content": "[second prompt...]"]
			["role": "assistant", "content": "[result...]"]
			...
		]
    ...
	],
	"session_number": [session number]
	"start_time": "HH:MM:SS"
}
```
9. Каждая сессия описывается временем начала этой сессии, номером сессии и набором "промптов", состоящих из списков ответов на запросы пользователя. Сессия сохраняется в файл "Session_[start_time]_[session_number].json".  
10. При обработке корректного пользовательского запроса будет открыт браузер Chromium, в котором далее ИИ-агент будет пытаться выполнить задание. Описание каждого выполняемого действия будет появляться в верхнем поле.
11. Если во время выполнения запроса нажать на зеленую кнопку, ИИ-агент в ближайшее время остановит выполнение пользовательского запроса.

## Информация
1. В качестве модели используется glm-4.6v-flash от [Zhipu AI](https://z.ai/subscribe).  
2. Для обращения к модели используется официальная Z.ai SDK.  
3. Для автоматизации браузера используется библиотека Playwright.
4. Для извлечения информации со страницы используется BeautifulSoup, с помощью которого на странице находятся необходимые HTML элементы (пока что рассматриваются только button, a, input) и в них определяются необходимые для анализа атрибуты.
5. Для выполнения какого-либо действия на странице браузера используется архитектура tool calling: модель обучена так, чтобы на выходе выдавать JSON определенного формата, который затем программно проверяется на правильность и обрабатывается в соответствии с задачей.
6. Используется паттерн Sub-agent architecture. В программе есть три типа задач для ИИ-агента: проверка правильности API-ключа, определение задачи и URL страницы по пользовательскому вводу, определение текущей задачи по содержимому страницы. За каждую задачу отвечает отдельный агент.  
7. Используется паттерн Security layer. Модель уведомлена, что, если в задании предполагается деструктивное действие, одна должна сделать все остальные действия перед ним и остановиться.  
8. Описание агентов не включает в себя специальные заготовки действий агента, преднаписанные селекторы, подсказки по элементам.  
9. Язык программирования - Python.  
10. GUI библиотека - Pyside6.  